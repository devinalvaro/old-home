#!/usr/bin/env bash -v

# variables
install='sudo apt-get -y install'
remove='sudo apt-get -y remove'

install_path=/usr/local/share/kitty
bin_path=/usr/local/bin/kitty
desktop_path=/usr/share/applications/kitty.desktop

read -d '' kitty_bin << EOF
#!/usr/bin/env python3

import runpy
runpy.run_path('/usr/local/share/kitty', run_name='__main__')
EOF

read -d '' kitty_desktop << EOF
[Desktop Entry]
Version=1.0
Type=Application
Name=kitty
GenericName=Terminal emulator
Comment=A modern, hackable, featureful, OpenGL based terminal emulator
TryExec=kitty
Exec=kitty
Icon=terminal
Categories=System;TerminalEmulator;
EOF

# --------------------------------

# clone
git clone https://github.com/kovidgoyal/kitty && cd kitty/

# install dependencies
$install build-essential \
    pkg-config \
    libharfbuzz-dev \
    libpng-dev \
    libfontconfig-dev \
    libgl-dev \
    python3-dev \
    libxkbcommon-x11-dev \
    xorg-dev

# make
make && cd ..

# remove build dependencies
$remove build-essential \
    pkg-config \
    libxkbcommon-x11-dev \
    xorg-dev

# install
sudo mv kitty $install_path

echo "$kitty_bin" > $bin_path
sudo chmod +x $bin_path

echo "$kitty_desktop" > $desktop_path
